IAM principals?

The AWS STS API includes a method, sts:GetCallerIdentity, which allows you to validate the identity of a client

However, it means that the Vault server does need network-level access to send requests to the STS endpoint.

The iam auth method allows you to specify a bound IAM principal ARN. Clients authenticating to Vault must have an ARN that matches the ARN bound to the role they are attempting to login to.

For example, if the bound ARN were arn:aws:iam::123456789012:* 

it would allow any principal in AWS account 123456789012 to login to it. Similarly, if it were arn:aws:iam::123456789012:role/*

If you wish to specify a wildcard, you must give Vault iam:GetUser and iam:GetRole permissions to properly resolve the full user path.

the iam method includes the ability for you to "infer" an EC2 instance ID from the authenticated client and apply many of the bindings that would otherwise only apply specifically to EC2 instances.


vault needs to be able to 

"ec2:DescribeInstances",
        "iam:GetInstanceProfile",
        "iam:GetUser",
        "iam:GetRole"

In many cases, an organization will use a "seed AMI" that is specialized after bootup by configuration management or similar processes. For this reason, a role entry in the method can also be associated with a "role tag" when using the ec2 auth type

These tags are generated by the method and are placed as the value of a tag with the given key on the EC2 instance. The role tag can be used to further restrict the parameters set on the role, but cannot be used to grant additional privileges. If a role with an AMI bind constraint has "role tag" enabled on the role, and the EC2 instance performing login does not have an expected tag on it, or if the tag on the instance is deleted for some reason, authentication fails

---------
but instance metadata can be an incredibly dangerous feature. All it takes is an arbitrary GET request to http://169.254.169.254/ to obtain AWS credentials.

The iam auth method authenticates AWS IAM principals. This can include IAM users, IAM roles assumed from other accounts, AWS Lambdas that are launched in an IAM role, or even EC2 instances that are launched in an IAM instance profile.

-------

The actual secret (i.e., the AWS secret access key) is never transmitted over the wire, and the AWS signature algorithm automatically expires requests after 15 minutes, providing simple and robust protection against replay attacks

If you are running your application on AWS ECS then the application will use the IAM role assigned to the ECS task of the running container
When using the AWS-IAM authentication you must create a role in Vault and assign it to your IAM role. An empty role defaults to the friendly name the current IAM role.

role sets the name of the role against which the login is being attempted. This should be bound to your IAM role. If one is not supplied then the friendly name of the current IAM user will be used as the vault role.
aws-path sets the path of the AWS mount to use
server-id sets the value to use for the X-Vault-AWS-IAM-Server-ID header preventing certain types of replay attacks.

AWS-IAM requires the AWS Java SDK dependency (com.amazonaws:aws-java-sdk-core) as the authentication implementation uses AWS SDK types for credentials and request signing.
